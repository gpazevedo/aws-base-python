# Application Infrastructure

This directory contains Terraform configuration for your application infrastructure.

## Structure

- `main.tf` - Main Terraform configuration and provider setup
- `variables.tf` - Variable definitions
- `lambda.tf` - Lambda function resources
- `api-gateway.tf` - API Gateway configuration (optional)
- `outputs.tf` - Output values
- `environments/` - Environment-specific variable files
  - `dev.tfvars` - Development environment
  - `test.tfvars` - Test environment
  - `prod.tfvars` - Production environment
  - `*-backend.hcl` - Backend configurations (generated by `make setup-terraform-backend`)

## Prerequisites

1. Bootstrap infrastructure must be deployed first:
   ```bash
   make bootstrap-create
   make bootstrap-init
   make bootstrap-apply
   make setup-terraform-backend
   ```

2. Docker image must be built and pushed to ECR:
   ```bash
   make docker-build
   make docker-push-dev
   ```

## Usage

### Development Environment

```bash
# Initialize Terraform
make app-init-dev

# Plan changes
make app-plan-dev

# Apply changes
make app-apply-dev

# View outputs
cd terraform && terraform output
```

### Production Environment

```bash
make app-init-prod
make app-plan-prod
make app-apply-prod
```

## Customization

1. Edit `environments/{env}.tfvars` to customize settings per environment
2. Modify `lambda.tf` to add more Lambda functions
3. Enable API Gateway by setting `enable_api_gateway = true` in tfvars
4. Add more resources as needed (databases, queues, etc.)

## Notes

- Lambda functions use container images from ECR
- CloudWatch Logs are automatically configured
- Lambda Function URLs are enabled by default (no API Gateway needed)
- First apply will fail if Docker image doesn't exist in ECR
